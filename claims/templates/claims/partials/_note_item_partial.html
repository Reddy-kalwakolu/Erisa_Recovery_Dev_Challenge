{% comment %} claims/templates/claims/partials/_note_item_partial.html {% endcomment %}
<div id="note-{{ note.pk }}" x-data="{ isEditing: false }" class="border-l-2 border-blue-500 pl-3">
    <div x-show="!isEditing">
        <div class="flex justify-between items-center text-sm">
            <p class="font-semibold text-blue-700">
                {{ note.user.username }}
                {% if note.user == request.user and not note.is_public %}
                    <span class="text-xs font-normal text-gray-500">(Personal)</span>
                {% endif %}
            </p>
            <div class="flex items-center gap-x-2">
                <p class="text-gray-600">{{ note.created_at|timesince }} ago</p>

                {% if note.user == request.user %}
                    <button @click="isEditing = true" class="text-gray-400 hover:text-blue-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z" />
                        </svg>
                    </button>
                    <button 
                        hx-post="{% url 'claims:delete-note' note.pk %}"
                        hx-target="#note-{{ note.pk }}"
                        hx-swap="outerHTML"
                        hx-confirm="Are you sure you want to delete this note?"
                        class="text-gray-400 hover:text-red-500"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    </button>
                {% endif %}
            </div>
        </div>
        <p class="text-sm text-gray-700">{{ note.text }}</p>
    </div>

    <div x-show="isEditing" x-cloak>
        <form 
            hx-post="{% url 'claims:edit-note' note.pk %}"
            hx-target="#note-{{ note.pk }}"
            hx-swap="outerHTML"
            class="space-y-2"
        >
            {% csrf_token %}
            <textarea name="note_text" class="w-full bg-white/50 border border-gray-300/50 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-400 transition text-sm" rows="3">{{ note.text }}</textarea>
            <div class="flex justify-end gap-2">
                <button type="button" @click="isEditing = false" class="py-1 px-3 text-sm rounded-lg bg-gray-200 hover:bg-gray-300 transition">Cancel</button>
                <button type="submit" class="py-1 px-3 text-sm rounded-lg bg-blue-500 hover:bg-blue-600 text-white transition">Save</button>
            </div>
        </form>
    </div>
</div>